---
title: è·¨æ ‡ç­¾é¡µé€šä¿¡
date: 2025-07-09
category:
  - Webå‰ç«¯ç»¼åˆ
tag:
  - BroadCast Channel
  - Service Worker
  - LocalStorage
  - Shared Worker
  - window.open
  - WebSocket
  - SharedArrayBuffer
---

# è·¨æ ‡ç­¾é¡µé€šä¿¡

åŸæ–‡ç« é“¾æ¥ï¼š[å¦‚ä½•è·¨æ ‡ç­¾é¡µé€šä¿¡](https://juejin.cn/post/7490769323969167394)

### ğŸ¨ æ–¹æ¡ˆ 1ï¼šBroadCast Channelï¼ˆå¯¹è®²æœºé¢‘é“ï¼‰

```js
// æ‰€æœ‰æ ‡ç­¾é¡µåŠ å…¥åŒä¸€ä¸ª"é¢‘é“"
const channel = new BroadcastChannel("shop_channel");

// æ ‡ç­¾1å‘é€æ¶ˆæ¯
channel.postMessage({ action: "addToCart", item: "å¯çˆ±çŒ«çŒ«" });

// æ ‡ç­¾2æ¥æ”¶æ¶ˆæ¯
channel.onmessage = (event) => {
  console.log("æ”¶åˆ°æ¶ˆæ¯:", event.data);
  // æ˜¾ç¤ºï¼š"æ”¶åˆ°æ¶ˆæ¯: {action: "addToCart", item: "å¯çˆ±çŒ«çŒ«"}"
};
```

ğŸ“Œ ç‰¹ç‚¹ï¼š

å°±åƒä¸€ç¾¤äººåœ¨åŒä¸€ä¸ªå¯¹è®²æœºé¢‘é“èŠå¤©
ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒï¼ˆIE é™¤å¤– ğŸ˜…ï¼‰
é€‚åˆé¢‘ç¹é€šä¿¡

### ğŸ› ï¸ æ–¹æ¡ˆ 2ï¼šService Workerï¼ˆéšå½¢é‚®å·®ï¼‰

```js
// service-worker.js
self.addEventListener("message", (event) => {
  // å‘Šè¯‰æ‰€æœ‰æ ‡ç­¾é¡µ
  self.clients.matchAll().then((clients) => {
    clients.forEach((client) => client.postMessage(event.data));
  });
});

// æ ‡ç­¾é¡µä»£ç 
navigator.serviceWorker.onmessage = (event) => {
  console.log("é‚®å·®é€æ¥æ¶ˆæ¯:", event.data);
};

// å‘é€æ¶ˆæ¯
navigator.serviceWorker.controller.postMessage("å¿«é€’åˆ°å•¦ï¼");
```

ğŸ¯ é€‚ç”¨åœºæ™¯ï¼š

PWA åº”ç”¨ï¼ˆæ¯”å¦‚ç¦»çº¿å¯ç”¨çš„ç½‘é¡µï¼‰
éœ€è¦åå°åŒæ­¥çš„åœºæ™¯

### ğŸ“¦ æ–¹æ¡ˆ 3ï¼šLocalStorageï¼ˆå…±äº«å°æœ¬æœ¬ï¼‰

```js
// æ ‡ç­¾1å†™ä¸‹ç•™è¨€
localStorage.setItem("message", "ä»Šæ™šåƒç«é”…ï¼");

// æ ‡ç­¾2ç›‘å¬å°æœ¬æœ¬å˜åŒ–
window.addEventListener("storage", (event) => {
  if (event.key === "message") {
    console.log("æ–°ç•™è¨€:", event.newValue);
  }
});
```

âš ï¸ æ³¨æ„ï¼š

å½“å‰æ ‡ç­¾é¡µä¿®æ”¹ä¸ä¼šè§¦å‘è‡ªå·±çš„ç›‘å¬
å®¹é‡çº¦ 5MBï¼ˆèƒ½å†™å¾ˆå¤šå°çº¸æ¡å•¦ï¼‰

### ğŸ‘¨â€ğŸ’» æ–¹æ¡ˆ 4ï¼šShared Workerï¼ˆå…±äº«åŠå…¬å®¤ï¼‰

```js
// shared-worker.js
const ports = []; // è¿æ¥çš„æ‰€æœ‰æ ‡ç­¾é¡µ

onconnect = (e) => {
  const port = e.ports[0];
  ports.push(port);

  port.onmessage = (event) => {
    // å¹¿æ’­ç»™å…¶ä»–åŒäº‹
    ports.forEach((p) => p !== port && p.postMessage(event.data));
  };
};

// æ ‡ç­¾é¡µä»£ç 
const worker = new SharedWorker("shared-worker.js");
worker.port.onmessage = (event) => {
  console.log("åŠå…¬å®¤é€šçŸ¥:", event.data);
};
worker.port.postMessage("å¤§å®¶å¥½å‘€ï¼");
```

ğŸ’¡ æ¯”å–»ï¼š

å°±åƒå¤šä¸ªæ ‡ç­¾é¡µåœ¨ä¸€ä¸ªå…±äº«åŠå…¬å®¤å·¥ä½œ
é€šè¿‡ä¸­é—´çš„ worker ä¼ é€’æ¶ˆæ¯

### ğŸ•µï¸â€â™‚ï¸ æ–¹æ¡ˆ 5-6ï¼šè½®è¯¢ä¾¦æŸ¥é˜Ÿï¼ˆIndexedDB/Cookieï¼‰

```js
// æ–¹æ¡ˆ5ï¼šIndexedDBè½®è¯¢
setInterval(() => {
  db.get("message").then((val) => {
    if (val !== lastMessage) {
      console.log("å‘ç°æ–°æ¶ˆæ¯:", val);
      lastMessage = val;
    }
  });
}, 1000);

// æ–¹æ¡ˆ6ï¼šCookieè½®è¯¢
setInterval(() => {
  const msg = getCookie("message");
  if (msg !== lastMsg) {
    console.log("Cookieæ¶ˆæ¯:", msg);
    lastMsg = msg;
  }
}, 1000);
```

ğŸš¨ æ³¨æ„ï¼š

åƒä¸æ–­æ£€æŸ¥ä¿¡ç®±çš„ä¾¦æŸ¥å‘˜
ä¸æ¨èé«˜é¢‘ä½¿ç”¨ï¼ˆè€—ç”µè€—èµ„æºï¼‰

### ğŸ‘¨â€ğŸ‘¦ æ–¹æ¡ˆ 7ï¼šwindow.openï¼ˆçˆ¶å­æ‚„æ‚„è¯ï¼‰

```js
// çˆ¶çª—å£
const child = window.open("child.html");
child.postMessage("ä¹–å„¿å­", "https://same-origin.com");

// å­çª—å£
window.opener.postMessage("è€çˆ¸å¥½ï¼", "https://same-origin.com");

// ä¸¤è¾¹éƒ½è¦ç›‘å¬
window.addEventListener("message", (event) => {
  if (event.origin !== "https://same-origin.com") return;
  console.log("æ”¶åˆ°:", event.data);
});
```

ğŸ”’ å®‰å…¨ç¬¬ä¸€ï¼š

å¿…é¡»éªŒè¯ event.originï¼
å°±åƒåªæ¥æ”¶è®¤è¯†çš„äººçš„ä¿¡ä»¶

### ğŸŒ æ–¹æ¡ˆ 8ï¼šWebSocketï¼ˆä¸“ä¸šç”µè¯çº¿ï¼‰

```js
// æ‰€æœ‰æ ‡ç­¾é¡µè¿æ¥åŒä¸€ä¸ªWebSocket
const socket = new WebSocket("wss://example.com/chat");

socket.onmessage = (event) => {
  console.log("æœåŠ¡å™¨é€šçŸ¥:", event.data);
};

// å‘é€æ¶ˆæ¯
socket.send("æ ‡ç­¾1å‘æ¥çš„æ¶ˆæ¯");
```

ğŸ† ä¼˜åŠ¿ï¼š

å®æ—¶æ€§æœ€å¼º
é€‚åˆéœ€è¦æœåŠ¡å™¨å‚ä¸çš„å¤æ‚åœºæ™¯

### ğŸ§© æ–¹æ¡ˆ 9ï¼šSharedArrayBufferï¼ˆå…±äº«é»‘æ¿ï¼‰

```js
// ä¸»çº¿ç¨‹
const buffer = new SharedArrayBuffer(1024);
const arr = new Int32Array(buffer);

// å¯ä»¥ä¼ é€’ç»™Worker
worker.postMessage({ buffer });

// Workerä¸­ä¿®æ”¹
Atomics.store(arr, 0, 123); // çº¿ç¨‹å®‰å…¨å†™å…¥
```

ğŸš§ æ³¨æ„ï¼š

éœ€è¦è®¾ç½®å®‰å…¨å“åº”å¤´
é€‚åˆé«˜æ€§èƒ½è®¡ç®—
